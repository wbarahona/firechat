"use strict";angular.module("angularFirebaseApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).factory("authInterceptor",["$q","$location",function(a,b){return{request:function(a){return a.headers=a.headers||{},localStorage.firebaseSession||"views/chat.html"!==a.url?a.headers.tokem=localStorage.firebaseSession:b.path("/login"),a},responseError:function(c){return 401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/chat",{templateUrl:"views/chat.html",controller:"ChatController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).when("/logout",{template:"Login out...",controller:"LogoutController"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterController"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]).constant("firebaseURL","https://vivid-heat-1154.firebaseio.com/").constant("fbMessagesURL","https://vivid-heat-1154.firebaseio.com/messages"),angular.module("angularFirebaseApp").directive("navbar",function(){return{restrict:"E",templateUrl:"views/navbar.html",controller:"NavigationController"}}),angular.module("angularFirebaseApp").controller("MainController",function(){}),angular.module("angularFirebaseApp").controller("ChatController",["$scope","$timeout","MessagesService",function(a,b,c){function d(a){for(var b=0;b<f.messages.length;b++){var c=f.messages[b];if(c.title===a){f.messages.splice(b,1);break}}}function e(a){for(var b=null,c=0;c<f.messages.length;c++){var d=f.messages[c];if(d.title===a){b=d;break}}return b}var f=a,g=10;f.currentUser=null,f.currentMessage=null,f.messages=[],f.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],c.getChatTitle(function(a){f.title=a.title}),c.childAdded(function(a){switch(a.event){case"child_added":f.messages.push(a);break;case"child_changed":var b=e(a.title);b.message=a.message;break;case"child_removed":d(a.title)}}),f.sendMessage=function(){var a={message:f.currentMessage,email:f.user.email,uid:f.user.uid},b=c.add(a);b.then(function(){}),f.currentMessage=null},f.turnFeedOff=function(){c.off()},f.pageNext=function(){var a=f.messages.length-1,b=f.messages[a];c.pageFlip(b.title,g,"next").then(function(a){f.messages=a})},f.pagePrev=function(){var a=f.messages[0];c.pageFlip(a.title,g,"prev").then(function(a){f.messages=a})}}]),angular.module("angularFirebaseApp").controller("RegisterController",["$scope","RegisterService","$location",function(a,b,c){var d=a;d.errors={exist:!1,message:""},d.registerUser={email:"",password:"",confirmPassword:""},d.register=function(){d.registerUser={email:d.registerForm.email.$viewValue,password:d.registerForm.password.$viewValue,repassword:d.registerForm.confirmPassword.$viewValue},d.registerUser.password!==d.registerUser.repassword?(d.errors.exist=!0,d.errors.message="Passwords does not match!"):(d.errors.exist=!1,d.errors.message=""),d.errors.message.length>0?d.errors.exist=!0:b.registerUser(d.registerUser).then(function(a){0===a.code?(d.errors.exist=!0,d.errors.message=a.message):c.path("/login")},function(a){console.log(a)})}}]),angular.module("angularFirebaseApp").controller("LoginController",["$scope","LoginService","$location","$rootScope",function(a,b,c,d){var e=a;e.user={email:"",password:""},e.errors={exist:!1,message:""},e.login=function(){b.login(e.user).then(function(a){0===a.code?(e.errors.exist=!0,e.errors.message=a.message):(e.errors.exist=!1,e.errors.message="",d.user=a.content,c.path("/chat"))},function(a){console.log(a)})}}]),angular.module("angularFirebaseApp").controller("LogoutController",["$location","LoginService",function(a,b){b.logout(),a.path("/")}]),angular.module("angularFirebaseApp").controller("NavigationController",["$scope","$location","LoginService",function(a,b,c){var d=a;d.isLoggedIn=c.isLoggedIn,d.isActive=function(a){var c=b.path().split("/")[1];return c===a.split("/")[1]}}]),angular.module("angularFirebaseApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("angularFirebaseApp").service("LoginService",["$firebaseSimpleLogin","$q","firebaseURL",function(a,b,c){var d=this,e=new Firebase(c),f=a(e),g={code:0,message:"",content:{}};d.login=function(a){var c=f.$login("password",{email:a.email,password:a.password}),d=b.defer();return c.then(function(a){g.code=1,g.content=a,d.resolve(g)},function(a){g.message="INVALID_PASSWORD"===a.code||"INVALID_USER"===a.code?"Hmmm... the user or password seems to be wrong! try again!":'Snap, this one was on us! How embarrasing, please try again or <a href="mailto:wbarahona@live.com">report</a> this error.',d.resolve(g)}),d.promise},d.logout=function(){f.$logout();return g.code=1,g.message="User logged out succesfully!",g},d.isLoggedIn=function(){return localStorage.getItem("firebaseSession")?!0:!1}}]),angular.module("angularFirebaseApp").service("MessagesService",["firebaseURL","fbMessagesURL","$q","$firebase",function(a,b,c,d){var e=new Firebase(a),f=new Firebase(b),g=e.child("title"),h=d(f.startAt().limit(10)).$asArray(),i=d(f).$asArray();return{getChatTitle:function(a){g.once("value",function(b){a.call(this,{title:b.val()})})},childAdded:function(a){i.$watch(function(b){var c=i.$getRecord(b.key);"child_removed"===b.event&&(c={name:"",message:""}),a.call(this,{event:b.event,email:c.email,message:c.message,title:b.key})})},add:function(a){var b=h.$add(a);return b},off:function(){h.$destroy()},pageFlip:function(a,b,d){var e=c.defer(),f=[],g={},h="",j=0;if(j=i.$indexFor(a),j>0&&j<i.length-1){"prev"===d&&(j-=b-1);for(var k=j;j+(b-1)>=k;k++)h=i.$keyAt(k),h&&(g=i.$getRecord(h),g.title=g.$id,f.push(g));e.resolve(f)}return e.promise}}}]),angular.module("angularFirebaseApp").service("RegisterService",["$firebaseSimpleLogin","$q","firebaseURL",function(a,b,c){var d=this,e=new Firebase(c),f=a(e),g={code:0,message:"",content:{}};d.registerUser=function(a){var c=f.$createUser(a.email,a.password),d=b.defer();return c.then(function(a){a.code=1,a.content=a,d.resolve(a)},function(a){g.message="EMAIL_TAKEN"===a.code?"Hmmm... this username seems to be already taken! try again!":'Snap, this one was on us! How embarrasing, please try again or <a href="mailto:wbarahona@live.com">report</a> this error.',d.resolve(g)}),d.promise}}]);